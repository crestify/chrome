var baseUrl="https://www.crestify.com/api/";chrome.tabs.onUpdated.addListener(function(e,o,t){"chrome://"!=t.url.substring(0,9)&&chrome.storage.sync.get(["useremail","userkey"],function(e){"undefined"==typeof e.useremail?(chrome.pageAction.show(t.id),chrome.pageAction.setIcon({tabId:t.id,path:"icon1.png"}),chrome.pageAction.setPopup({tabId:t.id,popup:"popup-login.html"})):require(["/libs/superagent.min.js"],function(o){o.post(baseUrl+"check").send({email:e.useremail,apikey:e.userkey,url:t.url}).end(function(e,o){null===e?"You have this URL bookmarked"==o.body.message?(chrome.pageAction.show(t.id),chrome.pageAction.setIcon({tabId:t.id,path:"icon2.png"}),chrome.pageAction.setTitle({tabId:t.id,title:"This page was bookmarked "+o.body.added}),chrome.pageAction.setPopup({tabId:t.id,popup:"popup-add.html"})):401===o.status?(chrome.pageAction.show(t.id),chrome.pageAction.setPopup({tabId:t.id,popup:"popup-login.html"})):(chrome.pageAction.show(t.id),chrome.pageAction.setIcon({tabId:t.id,path:"icon1.png"})):(chrome.pageAction.show(t.id),chrome.pageAction.setIcon({tabId:t.id,path:"icon1.png"}))})})})}),chrome.pageAction.onClicked.addListener(function(e){chrome.pageAction.setIcon({tabId:e.id,path:"progress.png"}),chrome.storage.sync.get(["useremail","userkey"],function(o){require(["/libs/superagent.min.js"],function(t){t.post(baseUrl+"add").send({email:o.useremail,apikey:o.userkey,url:e.url,title:encodeURI(e.title)}).end(function(o,t){null===o&&"URL bookmarked"==t.body.message?(chrome.pageAction.setIcon({tabId:e.id,path:"icon2.png"}),chrome.pageAction.setTitle({tabId:e.id,title:"This page was bookmarked just now"}),chrome.pageAction.setPopup({tabId:e.id,popup:"popup-add.html"})):chrome.pageAction.setIcon({tabId:e.id,path:"icon1.png"})})})})});